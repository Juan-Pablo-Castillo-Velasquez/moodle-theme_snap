define ("theme_snap/course-lazy",["jquery","theme_snap/util","theme_snap/section_asset_management","theme_snap/course_modules","core/str"],function(a,b,c,d,e){return function(f){var g=this;g.courseConfig=f;var h=function(){return 0===a("body").attr("id").indexOf("page-course-view-")},i=function(c){a("#toc-search-results").html("");var d=a("#"+c.replace("#",""));b.scrollToElement(d);var e=a("#searchpin");if(!e.length){e=a("<i id=\"searchpin\"></i>")}a(d).find(".instancename").prepend(e);a(d).attr("tabindex","-1").focus();a("#course-toc").removeClass("state-visible")};this.setTOCVisibleSection=function(){var b=a(".section.main.state-visible, #coursetools.state-visible, #snap-add-new-section.state-visible").attr("id");a("#chapters li").removeClass("snap-visible-section");a("#chapters a[href$=\""+b+"\"]").parent("li").addClass("snap-visible-section");a(document).trigger("snapContentRevealed")};var j=function(a){return-1!=window.location.href.indexOf(a)};this.showSection=function(){if(!h()){return}var b="";if(a(".section.main.state-visible.set-by-server").length){b="#"+a(".section.main.state-visible.set-by-server").attr("id");a(".section.main.state-visible.set-by-server").removeClass("set-by-server")}else{a(".course-content .section.main, #moodle-blocks,#coursetools, #snap-add-new-section,#tiles-section").removeClass("state-visible")}var c=location.hash.split("&"),d=c[0],f=c[1]||null;if(""==d){var l=location.search.substring(1),m=l.split("&");m.forEach(function(a){if(0<=a.indexOf("section=")){a.replace(a);d="#"+a.replace("=","-")}})}if(""!==d&&d!==b){a(b).removeClass("state-visible")}var n=".btn-editing",o="#coursetools",p=a(o).hasClass("editing-tiles");if(p){a(o).removeClass("state-visible");a(o).addClass("d-none")}var q=j("section-0"),r=j("coursetools");if(q&&!r){a("#tiles-section").addClass("state-visible");a(o).removeClass("state-visible");a(o).addClass("d-none")}if(!q&&r){var v=a("#snap-course-tools").hasClass("tiles-dashboard");if(v){a("#tiles-section").removeClass("state-visible");a(o).addClass("state-visible");a(o).removeClass("d-none");var s=document.querySelector(n).href,t=s.includes("#coursetools");if(!t){e.get_strings([{key:"editcoursecontent",component:"theme_snap"},{key:"editmodetiles",component:"theme_snap"},{key:"turneditingoff",component:"moodle"}]).done(function(a){var b=document.querySelector(n).text;if(b==a[1]){document.querySelector(n).innerHTML=a[0]}else{document.querySelector(n).innerHTML=a[2]}});document.querySelector(n).href=s+"#coursetools";a("#snap-editmode-header").addClass("d-none")}}}if("#coursetools"==d){a("#moodle-blocks").addClass("state-visible")}if(null!==f){a(d).addClass("state-visible");i(f)}else{a(d).addClass("state-visible").focus();k()}var u=a(".section.main.state-visible,#coursetools.state-visible,#snap-add-new-section.state-visible");if(!u.length){if(a(".section.main.current").length){a(".section.main.current").addClass("state-visible").focus()}else{a("#section-0").addClass("state-visible").focus()}k()}if(""==d&&"tiles"==g.courseConfig.format){a("#tiles-section").addClass("state-visible").focus()}a("li.snap-activity:visible, li.snap-resource:visible").on("click","a.mod-link",function(){sessionStorage.setItem("lastMod",a(this).parents("[id^=module]").attr("id"))});this.setTOCVisibleSection()};var k=function(){var c=sessionStorage.getItem("lastMod");if(null===c){window.scrollTo(0,0)}else{b.scrollToElement(a("#"+c+""));sessionStorage.removeItem("lastMod")}},l=function(){var b=a(location).attr("hash"),d=b.replace("#","").split("&"),e=!1,f=0;a.each(d,function(a,b){if(-1!=b.indexOf("section")){e=b.split("section-")[1]}else if(-1!=b.indexOf("module")){f=b.split("module-")[1]}});if(!e){var g=location.search.substring(1),h=g.split("&");h.forEach(function(a){if(0<=a.indexOf("section=")){a.replace(a);e=a.replace("section=","")}})}if(e&&0<a(".chapters .chapter-title[href=\"#section-"+e+"\"]").length){c.renderAndFocusSection(e,f)}};(function init(){c.init(g);d.init(f);if(g.courseConfig.enablecompletion){require(["theme_snap/course_conditionals-lazy"],function(a){a(f)})}if(h()){g.showSection();a(document).on("snapTOCReplaced",function(){g.setTOCVisibleSection();if(g.courseConfig.partialrender){c.setTocObserver()}});if(g.courseConfig.partialrender){l();a(window).on("hashchange",function(){l()});var b=a(".course-content li[id^=\"section-\"]"),e=location.hash.split("&"),i=e[0];if(1==b.length&&"#coursetools"!=i){b.addClass("state-visible");var j=b.attr("id").split("section-")[1];if("top"==g.courseConfig.toctype&&"topics"==g.courseConfig.format&&0<j){var k=b.find(".sectionname").html(),m=a(".chapter-title"),n=0;a.each(m,function(b,c){if(a(c).attr("section-number")==j){n=b}});b.find(".sectionname").html(k);b.find(".sectionnumber").html(n+".")}}}}})();(function modchooserSectionLinks(){a(".section-modchooser-link").click(function(){var b=a(this).attr("data-sectionid");a(".snap-modchooser-addlink").each(function(){var c=this.href.replace(/(section=)[0-9]+/ig,"$1"+b);a(this).attr("href",c)})})})()}});
//# sourceMappingURL=course-lazy.min.js.map
