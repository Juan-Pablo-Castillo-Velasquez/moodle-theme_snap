{"version":3,"sources":["../src/course-lazy.js"],"names":["define","$","util","sectionAssetManagement","courseModules","str","courseConfig","self","onCoursePage","attr","indexOf","scrollToModule","modid","html","targmod","replace","scrollToElement","searchpin","length","find","prepend","focus","removeClass","setTOCVisibleSection","currentSectionId","parent","addClass","document","trigger","checkToolParameter","checkParameter","window","location","href","showSection","sectionSetByServer","urlParams","hash","split","section","mod","qs","search","substring","sparameters","forEach","param","btnEditing","courseTools","tilesEditing","hasClass","sectionParameter","dashboardParameter","tilesDashboard","urlEditing","querySelector","existToolParameter","includes","get_strings","key","component","done","stringsjs","btnEditText","text","innerHTML","scrollBack","visibleChapters","format","on","sessionStorage","setItem","parents","storedmod","getItem","scrollTo","removeItem","renderFromHash","params","each","idx","renderAndFocusSection","init","enablecompletion","require","conditionals","partialrender","setTocObserver","sections","sectionParam","toctype","title","elements","tmpid","element","modchooserSectionLinks","click","sectionNum","newLink"],"mappings":"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","sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package\n * @copyright Copyright (c) 2016 Open LMS (https://www.openlms.net)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Course main functions.\n */\ndefine(\n    [\n        'jquery',\n        'theme_snap/util',\n        'theme_snap/section_asset_management',\n        'theme_snap/course_modules',\n        'core/str'\n    ],\n    function($, util, sectionAssetManagement, courseModules, str) {\n\n    /**\n     * Return class(has private and public methods).\n     * @param {object} courseConfig\n     */\n    return function(courseConfig) {\n\n        var self = this;\n\n        self.courseConfig = courseConfig;\n\n        /**\n         * Are we on the main course page - i.e. TOC is visible.\n         * @returns {boolean}\n         */\n        var onCoursePage = function() {\n            return $('body').attr('id').indexOf('page-course-view-') === 0;\n        };\n\n        /**\n         * Scroll to a mod via search\n         * @param {string} modid\n         */\n        var scrollToModule = function(modid) {\n            // Sometimes we have a hash, sometimes we don't\n            // strip hash then add just in case\n            $('#toc-search-results').html('');\n            var targmod = $(\"#\" + modid.replace('#', ''));\n            // http://stackoverflow.com/questions/6677035/jquery-scroll-to-element\n            util.scrollToElement(targmod);\n\n            var searchpin = $(\"#searchpin\");\n            if (!searchpin.length) {\n                searchpin = $('<i id=\"searchpin\"></i>');\n            }\n\n            $(targmod).find('.instancename').prepend(searchpin);\n            $(targmod).attr('tabindex', '-1').focus();\n            $('#course-toc').removeClass('state-visible');\n        };\n\n        /**\n         * Mark the section shown to user with a class in the TOC.\n         */\n        this.setTOCVisibleSection = function() {\n            var sectionIdSel = '.section.main.state-visible, #coursetools.state-visible, #snap-add-new-section.state-visible';\n            var currentSectionId = $(sectionIdSel).attr('id');\n            $('#chapters li').removeClass('snap-visible-section');\n            $('#chapters a[href$=\"' + currentSectionId + '\"]').parent('li').addClass('snap-visible-section');\n            $(document).trigger('snapContentRevealed');\n        };\n\n        /**\n         * Check if current url is having specific parameter on it.\n         * @param {string} checkParameter\n         */\n        var checkToolParameter = function(checkParameter) {\n            return window.location.href.indexOf(checkParameter) != -1;\n        };\n\n        /**\n         * When on course page, show the section currently referenced in the location hash.\n         */\n        this.showSection = function() {\n            if (!onCoursePage()) {\n                // Only relevant for main course page.\n                return;\n            }\n            var sectionSetByServer = '';\n\n            if ($('.section.main.state-visible.set-by-server').length) {\n                sectionSetByServer = '#' + $('.section.main.state-visible.set-by-server').attr('id');\n                $('.section.main.state-visible.set-by-server').removeClass('set-by-server');\n            } else {\n                $('.course-content .section.main, #moodle-blocks,#coursetools, #snap-add-new-section,' +\n                    '#tiles-section').removeClass('state-visible');\n            }\n\n            // We know the params at 0 is a section id.\n            // Params will be in the format: #section-[number]&module-[cmid], e.g: #section-1&module-7255.\n            var urlParams = location.hash.split(\"&\"),\n                section = urlParams[0],\n                mod = urlParams[1] || null;\n            if (section == '') {\n                var qs = location.search.substring(1);\n                var sparameters = qs.split('&');\n                sparameters.forEach(function(param) {\n                    if (param.indexOf('section=') >= 0) {\n                        param.replace(param);\n                        section = '#' + param.replace('=', '-');\n                    }\n                });\n            }\n\n            if (section !== '' && section !== sectionSetByServer) {\n                $(sectionSetByServer).removeClass('state-visible');\n            }\n\n            // Dashboard in Tiles should be hidden except in #coursetools section.\n            let editModeHeader = '#snap-editmode-header';\n            let btnEditing = '.btn-editing';\n            let courseTools = '#coursetools';\n            let tilesEditing = $(courseTools).hasClass('editing-tiles');\n            if (tilesEditing) {\n                $(courseTools).removeClass('state-visible');\n                $(courseTools).addClass('d-none');\n            }\n            let sectionParameter = checkToolParameter('section-');\n            let dashboardParameter = checkToolParameter('coursetools');\n            if (sectionParameter && !dashboardParameter) {\n                $('#tiles-section').addClass('state-visible');\n                $(courseTools).removeClass('state-visible');\n                $(courseTools).addClass('d-none');\n            }\n            if (!sectionParameter && dashboardParameter) {\n                let tilesDashboard = $('#snap-course-tools').hasClass('tiles-dashboard');\n                if (tilesDashboard) {\n                    $('#tiles-section').removeClass('state-visible');\n                    $(courseTools).addClass('state-visible');\n                    $(courseTools).removeClass('d-none');\n                    let urlEditing = document.querySelector(btnEditing).href;\n                    let existToolParameter = urlEditing.includes('#coursetools');\n                    if (!existToolParameter) {\n                        str.get_strings([\n                            {key: 'editcoursecontent', component: 'theme_snap'},\n                            {key: 'editmodetiles', component: 'theme_snap'},\n                            {key: 'turneditingoff', component: 'moodle'},\n                        ]).done(function(stringsjs) {\n                            let btnEditText = document.querySelector(btnEditing).text;\n                            if (btnEditText == stringsjs[1]) {\n                                document.querySelector(btnEditing).innerHTML = stringsjs[0];\n                            } else {\n                                document.querySelector(btnEditing).innerHTML = stringsjs[2];\n                            }\n                        });\n                        document.querySelector(btnEditing).href = urlEditing + '#coursetools';\n                        $(editModeHeader).addClass('d-none');\n                    }\n                }\n            }\n\n            // Course tools special section.\n            if (section == '#coursetools') {\n                $('#moodle-blocks').addClass('state-visible');\n            }\n\n            // If a modlue was in the hash then scroll to it.\n            if (mod !== null) {\n                $(section).addClass('state-visible');\n                scrollToModule(mod);\n            } else {\n                $(section).addClass('state-visible').focus();\n                // Faux link click behaviour - scroll to page top.\n                scrollBack();\n            }\n\n            // Default niceties to perform.\n            var visibleChapters = $(\n                '.section.main.state-visible,' +\n                '#coursetools.state-visible,' +\n                '#snap-add-new-section.state-visible'\n            );\n            if (!visibleChapters.length) {\n                if ($('.section.main.current').length) {\n                    $('.section.main.current').addClass('state-visible').focus();\n                } else {\n                    $('#section-0').addClass('state-visible').focus();\n                }\n                scrollBack();\n            }\n            if (section == '' && self.courseConfig.format == 'tiles') {\n                $('#tiles-section').addClass('state-visible').focus();\n            }\n\n            // Store last activity/resource accessed on sessionStorage\n            $('li.snap-activity:visible, li.snap-resource:visible').on('click', 'a.mod-link', function() {\n                sessionStorage.setItem('lastMod', $(this).parents('[id^=module]').attr('id'));\n            });\n\n\n            this.setTOCVisibleSection();\n        };\n\n        /**\n         * Scroll to the last activity or resource accessed,\n         * if there is nothing stored in session go to page top.\n         */\n        var scrollBack = function() {\n            var storedmod = sessionStorage.getItem('lastMod');\n            if (storedmod === null) {\n                window.scrollTo(0, 0);\n            } else {\n                util.scrollToElement($('#' + storedmod + ''));\n                sessionStorage.removeItem('lastMod');\n            }\n        };\n\n        /**\n         * Captures hash parameters and triggers the render method.\n         */\n        var renderFromHash = function() {\n            var hash = $(location).attr('hash');\n            var params = hash.replace('#', '').split('&');\n            var section = false;\n            var mod = 0;\n            $.each(params, function(idx, param) {\n                if (param.indexOf('section') != -1) {\n                    section = param.split('section-')[1];\n                } else if (param.indexOf('module') != -1) {\n                    mod = param.split('module-')[1];\n                }\n            });\n\n            if (!section) {\n                var qs = location.search.substring(1);\n                var sparameters = qs.split('&');\n                sparameters.forEach(function(param) {\n                    if (param.indexOf('section=') >= 0) {\n                        param.replace(param);\n                        section = param.replace('section=', '');\n                    }\n                });\n            }\n            if (section && $('.chapters .chapter-title[href=\"#section-' + section + '\"]').length > 0) {\n                sectionAssetManagement.renderAndFocusSection(section, mod);\n            }\n        };\n\n        /**\n         * Initialise course JS.\n         */\n        var init = function() {\n            sectionAssetManagement.init(self);\n            courseModules.init(courseConfig);\n\n            // Only load the conditionals library if it's enabled for the course, viva la HTTP2!\n            if (self.courseConfig.enablecompletion) {\n                require(\n                    [\n                        'theme_snap/course_conditionals-lazy'\n                    ], function(conditionals) {\n                        conditionals(courseConfig);\n                    }\n                );\n            }\n\n            // SL - 19th aug 2014 - check we are in a course and if so, show current section.\n            if (onCoursePage()) {\n                self.showSection();\n                $(document).on('snapTOCReplaced', function() {\n                    self.setTOCVisibleSection();\n                    if (self.courseConfig.partialrender) {\n                        sectionAssetManagement.setTocObserver();\n                    }\n                });\n                // Sets the observers for rendering sections on demand.\n                if (self.courseConfig.partialrender) {\n                    renderFromHash();\n                    $(window).on('hashchange', function() {\n                        renderFromHash();\n                    });\n                    // Current section might be hidden, at this point should be visible.\n                    var sections = $('.course-content li[id^=\"section-\"]');\n                    var urlParams = location.hash.split(\"&\"),\n                        sectionParam = urlParams[0];\n                    if (sections.length == 1 && sectionParam != '#coursetools') {\n                        sections.addClass('state-visible');\n                        var section = sections.attr('id').split('section-')[1];\n                        if (self.courseConfig.toctype == 'top' && self.courseConfig.format == 'topics' && section > 0) {\n                            var title = sections.find('.sectionname').html();\n                            var elements = $('.chapter-title');\n                            var tmpid = 0;\n                            $.each(elements, function(key, element) {\n                                if ($(element).attr('section-number') == section) {\n                                    tmpid = key;\n                                }\n                            });\n                            sections.find('.sectionname').html(title);\n                            sections.find('.sectionnumber').html(tmpid + '.');\n                        }\n                    }\n\n\n                }\n            }\n        };\n\n        /**\n         * Snap modchooser listener to add current section to urls.\n         */\n        var modchooserSectionLinks = function() {\n            $('.section-modchooser-link').click(function() {\n                // Grab the section number from the button.\n                var sectionNum = $(this).attr('data-sectionid');\n                $('.snap-modchooser-addlink').each(function() {\n                    // Update section in mod link to current section.\n                    var newLink = this.href.replace(/(section=)[0-9]+/ig, '$1' + sectionNum);\n                    $(this).attr('href', newLink);\n                });\n            });\n        };\n\n        // Intialise course lib.\n        init();\n        modchooserSectionLinks();\n    };\n});\n"],"file":"course-lazy.min.js"}